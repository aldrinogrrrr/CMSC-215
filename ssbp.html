<!DOCTYPE html>
<html>
  <head>

  </head>
  <body>

    <p class="display-welcomeMessage"></p>
    <p class="display-clientEnters"></p>
    <p class="display-waitingRoom"></p>
    <p class="display-barberRoom"></p>
    

    <script>

    barberRoomCapacity = 1; //one barber per client
    waitingRoomCapacity = 3; //3 chairs are offered in the waiting room. Can be modified for testing purposes.
    haircutCompletionTime = 6000; //2 seconds barber haircut completion time. Can be modified for testing purposes.
    clientInterval = 3000; // client comes in every 3 seconds. Can be modified for testing purposes.
    barberRoom = [];
    waitingRoom = [];
    barber = 'sleeping'; //barber status
    clientCount = 0; 
    totalClient = 6; //total clients to be served. Can be modified for testing purposes.

  function initiateClient() { 
    clientCount++;
    if (clientCount > totalClient) {
      console.log('All clients have been served.');
      clearInterval(simulationInterval);
      return null;
    }
    return { id: clientCount };
  }

  function enterBarbershop(client) {
    document.querySelector('.display-clientEnters').innerHTML = `Client ${client.id} enters the barbershop.`;
    console.log(`Client ${client.id} enters the barbershop.`);
    if (barberRoom.length < barberRoomCapacity) {
      enterBarberRoom(client);
    } else if (this.waitingRoom.length < waitingRoomCapacity) {
      enterWaitingRoom(client);
    } else {
      leaveBarbershop(client);
    }
  }

  function enterBarberRoom(client) {
    document.querySelector('.display-barberRoom').innerHTML = `Client ${client.id} enters the barber room.`;
    console.log(`Client ${client.id} enters the barber room.`);
    barberRoom.push(client);
    if (barber === 'sleeping') {
      wakeUpBarber();
    } else {
      initiateHaircut();
    }
  }

  function enterWaitingRoom(client) {
    document.querySelector('.display-waitingRoom').innerHTML = `Client ${client.id} enters the waiting room.`;
    console.log(`Client ${client.id} enters the waiting room.`);
    waitingRoom.push(client);
  }

  function leaveBarbershop(client) {
    console.log(`Client ${client.id} leaves.`);
    if (waitingRoom.length < waitingRoomCapacity) {
      console.log('Client ${customer.id} returns.');
      enterWaitingRoom(client);
    }
  }

  function wakeUpBarber() {
    console.log('The barber wakes up.');
    barber = 'working';
    initiateHaircut();
  }

  function initiateHaircut() {
    let client = barberRoom[0];
    console.log(`The barber starts cutting Client ${client.id}'s hair.`);
    setTimeout(() => {
      endHaircut();
    }, haircutCompletionTime);
  }

  function endHaircut() {
    let client = barberRoom.shift();
    console.log(`The barber finishes cutting Client ${client.id}'s hair. Client ${client.id} leaves the Barbershop`);
    if (waitingRoom.length > 0) {
      this.serveNextCustomer();
    } else {
      barberSleeps();
    }
  }

  function serveNextCustomer() {
    let client = this.waitingRoom.shift();
    console.log(`The barber goes to the waiting room and serves Client ${client.id}.`);
    enterBarberRoom(client);
  }

  function barberSleeps() {
    document.querySelector('.display-clientEnters').innerHTML = `No clients to serve. Barber goes back to sleep`;
    document.querySelector('.display-waitingRoom').innerHTML = ``;
    document.querySelector('.display-barberRoom').innerHTML = ``;
    console.log('The barber is finish and goes to sleep.');
    barber = 'sleeping';
  }

  function opensBarberShop() {
    document.querySelector('.display-welcomeMessage').innerHTML = `Barber shop is now open.`;
    console.log('Barber shop is now open.');
    simulationInterval = setInterval(() => {
      let client = initiateClient();
      if (client) {
        enterBarbershop(client);
      } else {
        clearInterval(intervalId);
      }
    }, clientInterval);
  }


opensBarberShop();

    </script>
  </body>
</html>